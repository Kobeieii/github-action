name: Deploy

on:
  workflow_run:
    workflows: ['Build']
    types:
      - completed
    branches:
      - "'main'"
      - "'develop'"

env:
  PROJECT_ID: swift-impulse-364410
  REGION: asia-southeast1
  SERVICE: ${{ github.event.repository.name }}-dev
  WORKLOAD_IDENTITY_PROVIDER: projects/657305254360/locations/global/workloadIdentityPools/github-pool/providers/github
  SERVICE_ACCOUNT: github-provider@swift-impulse-364410.iam.gserviceaccount.com

jobs:
  # Deploy:
  #   runs-on: ubuntu-latest
  #   permissions:
  #     contents: read
  #     id-token: write

  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v4

  #     - id: auth
  #       name: Authenticate to Google Cloud
  #       uses: google-github-actions/auth@v2
  #       with:
  #         workload_identity_provider: "${{ env.WORKLOAD_IDENTITY_PROVIDER }}"
  #         service_account: "${{ env.SERVICE_ACCOUNT }}"

  #     - name: Deploy to Cloud Run
  #       id: deploy
  #       uses: google-github-actions/deploy-cloudrun@v2
  #       with:
  #         service: "${{ env.SERVICE }}"
  #         region: "${{ env.REGION }}"
  #         image: "${{ env.REGION }}-docker.pkg.dev/${{ env.PROJECT_ID }}/cloud-run-source-deploy/${{ env.SERVICE }}:${{ github.sha }}"

  #     - name: Show output
  #       run: |2-
  #         echo ${{ steps.deploy.outputs.url }}
  Test:
    runs-on: ubuntu-latest

    steps:
      - name: Set ENV
        run: |-
          if [[ $GITHUB_REF == 'refs/heads/main' ]]; then
            echo "SERVICE=${{ github.event.repository.name }}" >> "$GITHUB_ENV"
          else
            echo "SERVICE=${{ github.event.repository.name }}-dev" >> "$GITHUB_ENV"
          fi

      - name: Show ENV
        run: echo $GITHUB_ENV

      - name: Show SERVICE
        run: echo ${{ env.SERVICE }}
